<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="妄言妄语当不得真,疯言疯语不足为信"><title>mysql临时表 | 吃饭不喝汤</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">mysql临时表</h1><a id="logo" href="/.">吃饭不喝汤</a><p class="description">饿了就吃饭渴了就喝水</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">mysql临时表</h1><div class="post-meta">Aug 20, 2019</div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#生成临时表的条件"><span class="toc-number">1.</span> <span class="toc-text">生成临时表的条件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UNION-statements"><span class="toc-number">1.1.</span> <span class="toc-text">UNION statements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#somw-views-such-those-that-use-the-TEMPTABLE-algorithm-UNION-or-aggregation"><span class="toc-number">1.2.</span> <span class="toc-text">somw views, such those that use the TEMPTABLE algorithm, UNION or aggregation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#derived-tables"><span class="toc-number">1.3.</span> <span class="toc-text">derived tables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#table-created-for-subquery-or-semijoin-materialization"><span class="toc-number">1.4.</span> <span class="toc-text">table created for subquery or semijoin materialization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#common-table-expressions"><span class="toc-number">1.5.</span> <span class="toc-text">common table expressions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DISTINCT-combined-with-ORDER-BY-may-require-a-temporary-table"><span class="toc-number">1.6.</span> <span class="toc-text">DISTINCT combined with ORDER BY may require a temporary table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#order-by和group-by的子句不一样时，或者表连接中order-by或group-by的列是被驱动表中的列"><span class="toc-number">1.7.</span> <span class="toc-text">order by和group by的子句不一样时，或者表连接中order by或group by的列是被驱动表中的列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#INSERT-SELECT"><span class="toc-number">1.8.</span> <span class="toc-text">INSERT ... SELECT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multiple-table-update-statements"><span class="toc-number">1.9.</span> <span class="toc-text">multiple-table update statements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GROUP-CONCAT-or-COUNT-DISTINCT"><span class="toc-number">1.10.</span> <span class="toc-text">GROUP_CONCAT() or COUNT(DISTINCT)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-SMALL-RESULT"><span class="toc-number">1.11.</span> <span class="toc-text">SQL_SMALL_RESULT</span></a></li></ol></li></ol></div></div><div class="post-content"><p>下面只介绍在查询中生成的临时表, 总结下来就是, 感觉用临时表了, 就去<code>explain</code>看下是不是到底用了, 最好每个sql都查下</p>
<p>在<code>EXPLAIN</code>中可以查看有没有用到temptable:<code>EXPLAIN SELECT emp_no FROM employees.salaries union  select emp_no from employees.salaries;</code></p>
<p><img src="../404/union_temptable.png" alt="有临时表"></p>
<p>但是使用<code>union all</code>没有临时表<code>EXPLAIN SELECT emp_no FROM employees.salaries union all select emp_no from employees.salaries;</code>:</p>
<p><img src="../404/union_all.png" alt="有临时表"></p>
<p>然后执行<code>show status like &quot;%tmp%&quot;;</code>如果有临时表会在下面的字段中体现:</p>
<p><img src="../404/mysql临时表的状态.png" alt="mysql临时表"></p>
<p>新增一个临时表会在对应的字段上+1</p>
<h2 id="生成临时表的条件"><a href="#生成临时表的条件" class="headerlink" title="生成临时表的条件"></a>生成临时表的条件</h2><h3 id="UNION-statements"><a href="#UNION-statements" class="headerlink" title="UNION statements"></a><code>UNION</code> statements</h3><ul>
<li>但是<code>UNION ALL</code>不会创建临时表</li>
<li>不是由全局的<code>ORDER BY</code>引起的</li>
<li>这个可以在上面的例子中看到, 执行<code>union all</code>没有用到临时表</li>
</ul>
<h3 id="somw-views-such-those-that-use-the-TEMPTABLE-algorithm-UNION-or-aggregation"><a href="#somw-views-such-those-that-use-the-TEMPTABLE-algorithm-UNION-or-aggregation" class="headerlink" title="somw views, such those that use the TEMPTABLE algorithm, UNION or aggregation"></a>somw views, such those that use the <code>TEMPTABLE</code> algorithm, <code>UNION</code> or aggregation</h3><p>这个没有实际用过, 待补充</p>
<h3 id="derived-tables"><a href="#derived-tables" class="headerlink" title="derived tables"></a>derived tables</h3><p>这个执行下面sql但是没有使用临时表, 有用的还是因为加了<code>group by</code>语法, 待解决:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">use</span> employees;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employees.t1 (s1 <span class="built_in">INT</span>, s2 <span class="built_in">CHAR</span>(<span class="number">5</span>), s3 <span class="built_in">FLOAT</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees.t1 <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'1'</span>,<span class="number">1.0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees.t1 <span class="keyword">VALUES</span> (<span class="number">2</span>,<span class="string">'2'</span>,<span class="number">2.0</span>);</span><br><span class="line"><span class="comment">-- 下面没有用临时表</span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">SELECT</span> <span class="keyword">sb1</span>,<span class="keyword">sb2</span>,sb3</span><br><span class="line">  <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> s1 <span class="keyword">AS</span> <span class="keyword">sb1</span>, s2 <span class="keyword">AS</span> <span class="keyword">sb2</span>, s3*<span class="number">2</span> <span class="keyword">AS</span> sb3 <span class="keyword">FROM</span> employees.t1) <span class="keyword">AS</span> sb</span><br><span class="line">  <span class="keyword">WHERE</span> <span class="keyword">sb1</span> &gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(<span class="keyword">SUM</span>(column1)) <span class="keyword">FROM</span> t1 <span class="keyword">GROUP</span> <span class="keyword">BY</span> column1;</span><br><span class="line"><span class="comment">-- 用了临时表 </span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sum_column1)</span><br><span class="line">  <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">SUM</span>(s1) <span class="keyword">AS</span> sum_column1</span><br><span class="line">        <span class="keyword">FROM</span> t1 <span class="keyword">GROUP</span> <span class="keyword">BY</span> s1) <span class="keyword">AS</span> t1;</span><br><span class="line"><span class="comment">--  没有用临时表</span></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sum_column1)</span><br><span class="line">  <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">SUM</span>(s1) <span class="keyword">AS</span> sum_column1</span><br><span class="line">        <span class="keyword">FROM</span> t1) <span class="keyword">AS</span> t1;</span><br></pre></td></tr></table></figure>
<h3 id="table-created-for-subquery-or-semijoin-materialization"><a href="#table-created-for-subquery-or-semijoin-materialization" class="headerlink" title="table created for subquery or semijoin materialization"></a>table created for subquery or semijoin materialization</h3><p>这里说是使用子查询的是会用到, 但是子查询和驱动表的区别是啥</p>
<h3 id="common-table-expressions"><a href="#common-table-expressions" class="headerlink" title="common table expressions"></a>common table expressions</h3><p>使用<code>with</code>语法的时候会创建临时表</p>
<h3 id="DISTINCT-combined-with-ORDER-BY-may-require-a-temporary-table"><a href="#DISTINCT-combined-with-ORDER-BY-may-require-a-temporary-table" class="headerlink" title="DISTINCT combined with ORDER BY may require a temporary table"></a><code>DISTINCT</code> combined with <code>ORDER BY</code> may require a temporary table</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">distinct</span> salary <span class="keyword">from</span> employees.salaries  <span class="keyword">order</span> <span class="keyword">by</span> salary ;</span><br><span class="line"><span class="comment">-- filesort: MySQLmust do an extra pass to find out how to retrieve the rows in sorted order. Thesort is done by going through all rows according to the join type and storingthe sort key and pointer to the row for all rows that match the WHERE clause.</span></span><br><span class="line"><span class="comment">-- # id, select_type, table, partitions, type, possible_keys, key, key_len, ref, rows, filtered, Extra</span></span><br><span class="line"><span class="comment">-- 1, SIMPLE, salaries, p01,p02,p03,p04,p05,p06,p07,p08,p09,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19, ALL, , , , , 2841613, 100.00, Using temporary; Using filesort</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这里给salary建立索引, 然后就不用临时表了</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employees.salaries <span class="keyword">add</span> <span class="keyword">index</span> keke(salary);</span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">distinct</span> salary <span class="keyword">from</span> employees.salaries  <span class="keyword">order</span> <span class="keyword">by</span> salary ;</span><br><span class="line"><span class="comment">-- '1', 'SIMPLE', 'salaries', 'p01,p02,p03,p04,p05,p06,p07,p08,p09,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19', 'range', 'keke', 'keke', '4', NULL, '703151', '100.00', 'Using index for group-by'</span></span><br></pre></td></tr></table></figure>
<h3 id="order-by和group-by的子句不一样时，或者表连接中order-by或group-by的列是被驱动表中的列"><a href="#order-by和group-by的子句不一样时，或者表连接中order-by或group-by的列是被驱动表中的列" class="headerlink" title="order by和group by的子句不一样时，或者表连接中order by或group by的列是被驱动表中的列"></a><code>order by</code>和<code>group by</code>的子句不一样时，或者表连接中<code>order by</code>或<code>group by</code>的列是被驱动表中的列</h3><h3 id="INSERT-SELECT"><a href="#INSERT-SELECT" class="headerlink" title="INSERT ... SELECT"></a><code>INSERT ... SELECT</code></h3><p>to evaluate <code>INSERT ... SELECT</code> statements that select from and insert into the same table, mysql creates an internal temporary table to hold te rows form the  <code>SELECT</code>, then inserts those rows into the target table.</p>
<h3 id="multiple-table-update-statements"><a href="#multiple-table-update-statements" class="headerlink" title="multiple-table update statements"></a>multiple-table <code>update</code> statements</h3><h3 id="GROUP-CONCAT-or-COUNT-DISTINCT"><a href="#GROUP-CONCAT-or-COUNT-DISTINCT" class="headerlink" title="GROUP_CONCAT() or COUNT(DISTINCT)"></a><code>GROUP_CONCAT()</code> or <code>COUNT(DISTINCT)</code></h3><p>为啥试了没有???</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">distinct</span> salary) <span class="keyword">from</span> employees.salaries;</span><br><span class="line"><span class="comment">-- # id, select_type, table, partitions, type, possible_keys, key, key_len, ref, rows, filtered, Extra</span></span><br><span class="line"><span class="comment">-- 1, SIMPLE, salaries, p01,p02,p03,p04,p05,p06,p07,p08,p09,p10,p11,p12,p13,p14,p15,p16,p17,p18,p19, ALL, , , , , 2841613, 100.00, null</span></span><br></pre></td></tr></table></figure>
<h3 id="SQL-SMALL-RESULT"><a href="#SQL-SMALL-RESULT" class="headerlink" title="SQL_SMALL_RESULT"></a><code>SQL_SMALL_RESULT</code></h3><p>for queries that use the <code>SQL_SMALL_RESULT</code> modifier, MySQL users an in-memory temporary table, unless the query also contains elements that require on-disk storage</p>
</div><div class="tags"><a href="/tags/mysql/">mysql</a></div><div class="post-nav"><a class="pre" href="/sql语法/">sql语法</a><a class="next" href="/上传文件中中文名称的处理和python实现/">flask上传文件中文名称的处理</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/源码解读/" style="font-size: 15px;">源码解读</a> <a href="/tags/es/" style="font-size: 15px;">es</a> <a href="/tags/flask/" style="font-size: 15px;">flask</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/flask源码/" style="font-size: 15px;">flask源码</a> <a href="/tags/flask路由/" style="font-size: 15px;">flask路由</a> <a href="/tags/k8s/" style="font-size: 15px;">k8s</a> <a href="/tags/路由寻址/" style="font-size: 15px;">路由寻址</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/脚本/" style="font-size: 15px;">脚本</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/常用函数/" style="font-size: 15px;">常用函数</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/消息队列/" style="font-size: 15px;">消息队列</a> <a href="/tags/tcp协议/" style="font-size: 15px;">tcp协议</a> <a href="/tags/开发环境配置/" style="font-size: 15px;">开发环境配置</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/转载-国内比较有名的自动驾驶公司/">转载___国内比较有名的自动驾驶公司</a></li><li class="post-list-item"><a class="post-list-link" href="/高并发优化的一些经验/">高并发优化的一些经验</a></li><li class="post-list-item"><a class="post-list-link" href="/写在使用es前/">写在使用es前</a></li><li class="post-list-item"><a class="post-list-link" href="/sql语法/">sql语法</a></li><li class="post-list-item"><a class="post-list-link" href="/mysql临时表/">mysql临时表</a></li><li class="post-list-item"><a class="post-list-link" href="/上传文件中中文名称的处理和python实现/">flask上传文件中文名称的处理</a></li><li class="post-list-item"><a class="post-list-link" href="/redis基本操作/">redis基本操作</a></li><li class="post-list-item"><a class="post-list-link" href="/redis对象/">redis对象</a></li><li class="post-list-item"><a class="post-list-link" href="/redis数据结构/">redis数据结构</a></li><li class="post-list-item"><a class="post-list-link" href="/redis高可用/">redis高可用</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">吃饭不喝汤.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>